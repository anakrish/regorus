# RBAC RVM Playground - File Structure

This document describes all files in the RBAC RVM Playground.

## Core Files

### `index.html`
**Main application page**
- Three-panel layout (Policy Editor | RVM Instructions | Evaluation)
- Navigation bar with example selector, share, settings, help buttons
- Modal dialogs for sharing and help
- Integrates CodeMirror for syntax-highlighted editing
- Responsive design with dark theme

**Key Sections:**
- Policy editor with validation and compilation controls
- RVM instruction viewer with statistics
- Evaluation panel with tabs: Context, Trace, Results, VM State
- Status bars showing compilation and evaluation status

### `styles.css`
**Complete styling for the playground**
- Dark theme inspired by VS Code
- CSS variables for consistent theming
- Responsive layout with flexbox
- Component styles: panels, buttons, tabs, modals
- Syntax highlighting colors
- Scrollbar customization
- Print-friendly styles

**Design System:**
- Primary colors: Blue (#007acc), Green (#4ec9b0), Yellow (#dcdcaa)
- Status colors: Success (green), Warning (yellow), Error (red)
- Monospace fonts for code display
- Smooth transitions and hover effects

### `app.js`
**Main application logic (ES6 module)**

**Class: `RbacPlayground`**
- WASM module loading with graceful fallback
- CodeMirror editor initialization
- Event handling for all UI interactions
- Policy compilation via WASM
- Policy evaluation via WASM
- State management for execution

**Key Methods:**
- `loadWasm()` - Dynamic import of WASM module
- `compilePolicy()` - Compile policy to RVM bytecode
- `evaluatePolicy()` - Evaluate policy against context
- `displayRvmInstructions()` - Render bytecode view
- `displayEvaluationResults()` - Show allow/deny results
- `loadExample()` - Load pre-built examples
- `validatePolicy()` - JSON validation
- `showShareModal()` - Generate shareable URLs

### `examples.js`
**Pre-built example policies and contexts**

Six complete examples:
1. **simple** - Basic storage reader role
2. **conditional** - Container name conditions
3. **storage** - Complex Azure Storage scenario
4. **time** - Time-of-day restrictions
5. **tags** - Tag-based ABAC
6. **multi** - Multiple roles with different scopes

Each example includes:
- Complete policy JSON (roleDefinitions + roleAssignments)
- Matching evaluation context
- Representative of real-world scenarios

## Documentation

### `README.md`
**Comprehensive documentation**
- Feature overview
- Architecture description
- Getting started guide
- Usage instructions
- RBAC policy structure
- Condition expression syntax
- Deployment instructions
- Future enhancements
- Technical details

### `QUICKSTART.md`
**Step-by-step guide for new users**
- 3-step setup (build, serve, open)
- First steps in the playground
- Example walkthroughs
- RVM instruction explanation
- Troubleshooting guide
- Tips and tricks
- Educational use cases

### `test.html`
**Testing suite and validation**
- Manual testing checklist
- Automated tests for WASM integration
- Example test scenarios
- Performance testing guidelines
- Known limitations
- Issue reporting guide

## Build & Configuration

### `build.sh`
**WASM module build script**
- Checks for wasm-pack installation
- Navigates to bindings/wasm directory
- Builds WASM module for web target
- Copies output to pkg/ directory
- Reports file sizes and status
- Shows next steps

**Usage:**
```bash
./build.sh
```

### `package.json`
**NPM package configuration**
- Project metadata
- Build and serve scripts
- Keywords for discovery
- License information

**Scripts:**
- `npm run build` - Run build.sh
- `npm run serve` - Start Python HTTP server
- `npm run dev` - Build and serve

### `.gitignore`
**Git ignore rules**
- Excludes pkg/ directory (generated files)
- OS-specific files (.DS_Store, Thumbs.db)
- Editor files (.vscode/, .idea/, *.swp)
- Log and temporary files

## Generated Directory

### `pkg/` (generated by build.sh)
**WASM module and JavaScript bindings**

Generated files (not in git):
- `regorusjs.js` - JavaScript wrapper
- `regorusjs_bg.wasm` - WebAssembly binary
- `regorusjs_bg.wasm.d.ts` - TypeScript definitions
- `regorusjs.d.ts` - API type definitions
- `package.json` - NPM package metadata

**WASM API:**
- `compileRbacToRvmProgram(policyJson: string): string`
- `evaluateRbacPolicy(policyJson: string, contextJson: string): string`
- `RbacPolicy` class
- `RbacEngine` class
- `RbacEvaluationContext` class

## File Dependencies

```
index.html
├── styles.css (styling)
├── examples.js (example data)
├── app.js (main logic)
│   └── pkg/regorusjs.js (WASM module)
└── CodeMirror (CDN)
    ├── codemirror.min.js
    ├── mode/javascript/javascript.min.js
    └── addons

test.html
├── styles (inline)
└── pkg/regorusjs.js (for automated tests)

build.sh
└── Generates pkg/ directory
```

## Size Estimates

Approximate file sizes:
- `index.html` - 10 KB
- `styles.css` - 8 KB
- `app.js` - 15 KB
- `examples.js` - 5 KB
- `pkg/regorusjs_bg.wasm` - ~1-2 MB (compressed)
- `pkg/regorusjs.js` - ~50 KB

Total playground size (without WASM): ~40 KB
Total with WASM: ~1-2 MB

## Browser Compatibility

**Minimum Requirements:**
- WebAssembly support
- ES6 module support
- Fetch API
- Async/await
- Dynamic import()

**Supported Browsers:**
- Chrome/Edge 88+
- Firefox 79+
- Safari 14.1+

**Not Supported:**
- Internet Explorer
- Legacy Edge (pre-Chromium)
- Very old mobile browsers

## Development Workflow

1. **Edit Rust code** in `../../bindings/wasm/src/lib.rs`
2. **Rebuild WASM** with `./build.sh`
3. **Refresh browser** (hard refresh: Cmd+Shift+R)
4. **Test changes** using examples or test.html
5. **Commit** (excluding pkg/ directory)

## Production Deployment

**For GitHub Pages:**
1. Build WASM: `./build.sh`
2. Commit all files including pkg/
3. Push to repository
4. Enable GitHub Pages (Settings → Pages)
5. Select branch and folder
6. Access at `https://username.github.io/repo/`

**For Custom Hosting:**
1. Build WASM locally
2. Upload all files to web server
3. Ensure MIME types:
   - `.wasm` → `application/wasm`
   - `.js` → `application/javascript`
4. Enable HTTPS (required for WASM)

## Security Considerations

- All processing happens client-side
- No data sent to servers
- WASM sandbox provides isolation
- CORS not required (same-origin)
- Shareable URLs encode data in fragment (not logged)

## Performance Characteristics

**Compilation:**
- Simple policy: < 50ms
- Complex policy: < 100ms
- Dependent on instruction count

**Evaluation:**
- Simple policy: < 5ms
- Complex policy: < 20ms
- RVM ~2-3x faster than interpreter

**Memory:**
- Base usage: ~10 MB
- WASM module: ~2-5 MB
- Per policy: ~1-10 KB
- Per evaluation: < 1 KB

## Maintenance

**Regular Tasks:**
- Update dependencies (CodeMirror, wasm-bindgen)
- Rebuild WASM after Rust changes
- Test in latest browsers
- Update documentation
- Add new examples

**Breaking Changes:**
- WASM API changes require app.js updates
- Major Rust version changes may need rebuild
- Browser API deprecations need fallbacks

## Future Files (Planned)

- `debugger.js` - Step-through debugger logic
- `profiler.js` - Performance profiling tools
- `visualizer.js` - Flow diagram generation
- `export.js` - Code generation for other formats
- `batch.js` - Batch testing interface
- `settings.js` - User preferences management

## Contributing

To add new features:
1. Update relevant files (app.js, styles.css, etc.)
2. Add documentation to README.md
3. Update test.html with new test cases
4. Test in multiple browsers
5. Update this file structure document

## Questions?

See:
- README.md for detailed usage
- QUICKSTART.md for getting started
- test.html for testing guide
- Comments in source files

---

**Last Updated:** 2025-01
**Version:** 1.0.0
**Total Files:** 11 (+ generated pkg/)
