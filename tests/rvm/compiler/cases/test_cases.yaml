# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

cases:
  - note: arithmetic_basic
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := 2 + 3
        }
    query: data.test.main
    want_result: 5

  - note: arithmetic_multiply
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := 4 * 6
        }
    query: data.test.main
    want_result: 24

  - note: arithmetic_division
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := 15 / 3
        }
    query: data.test.main
    want_result: 5

  - note: arithmetic_subtraction
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := 10 - 7
        }
    query: data.test.main
    want_result: 3

  - note: comparison_equals
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := (5 == 5)
        }
    query: data.test.main
    want_result: true

  - note: comparison_not_equals
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := (5 == 3)
        }
    query: data.test.main
    want_result: false

  - note: comparison_less_than
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := (3 < 5)
        }
    query: data.test.main
    want_result: true

  - note: comparison_greater_than
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := (7 > 5)
        }
    query: data.test.main
    want_result: true

  - note: variable_assignment
    data: {}
    modules:
      - |
        package test
        main := result if {
          x := 42
          result := x
        }
    query: data.test.main
    want_result: 42

  - note: rule_without_body
    data: {}
    modules:
      - |
        package test
        main = 100
    query: data.test.main
    want_result: 100

  - note: rule_dependency
    data: {}
    modules:
      - |
        package test
        x = 42
        main := result if {
          result := x + 10
        }
    query: data.test.main
    want_result: 52

  - note: rule_undefined_condition_fails
    data: {}
    modules:
      - |
        package test
        main := "success" if {
          false  # condition always fails
        }
    query: data.test.main
    want_result: "#undefined"

  - note: object_creation
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := {"name": "Alice", "age": 30, "active": true}
        }
    query: data.test.main
    want_result: {"name": "Alice", "age": 30, "active": true}

  - note: nested_objects
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := {
            "user": {
              "name": "Alice", 
              "details": {"age": 30, "active": true}
            },
            "config": {"debug": false}
          }
        }
    query: data.test.main
    want_result: {"user": {"name": "Alice", "details": {"age": 30, "active": true}}, "config": {"debug": false}}

  - note: object_field_access
    data: {}
    modules:
      - |
        package test
        user := {"name": "Alice", "age": 30}
        main := result if {
          result := user.name
        }
    query: data.test.main
    want_result: "Alice"

  - note: nested_object_access
    data: {}
    modules:
      - |
        package test
        user := {
          "name": "Alice", 
          "details": {
            "age": 30, 
            "profile": {
              "country": "USA",
              "city": "Seattle"
            }
          }
        }
        main := result if {
          result := user.details.profile.city
        }
    query: data.test.main
    want_result: "Seattle"

  - note: dynamic_field_name_get
    data: {}
    modules:
      - |
        package test
        user := {"name": "Alice", "age": 30, "status": "active"}
        field_name := "status"
        main := result if {
          result := user[field_name]
        }
    query: data.test.main
    want_result: "active"

  - note: dynamic_field_name_set
    data: {}
    modules:
      - |
        package test
        field_name := "email"
        field_value := "alice@example.com"
        main := result if {
          result := {field_name: field_value, "name": "Alice"}
        }
    query: data.test.main
    want_result: {"email": "alice@example.com", "name": "Alice"}

  - note: dynamic_object_construction
    data: {}
    modules:
      - |
        package test
        name_field := "username"
        name_value := "alice123"
        age_field := "user_age" 
        age_value := 25
        main := result if {
          result := {name_field: name_value, age_field: age_value}
        }
    query: data.test.main
    want_result: {"username": "alice123", "user_age": 25}

  - note: array_creation
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := [1, 2, 3, "hello", true]
        }
    query: data.test.main
    want_result: [1, 2, 3, "hello", true]

  - note: nested_arrays
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := [[1, 2], [3, 4], ["a", "b"]]
        }
    query: data.test.main
    want_result: [[1, 2], [3, 4], ["a", "b"]]

  - note: array_indexing
    data: {}
    modules:
      - |
        package test
        arr := [10, 20, 30, 40]
        main := result if {
          result := arr[2]
        }
    query: data.test.main
    want_result: 30

  - note: dynamic_array_indexing
    data: {}
    modules:
      - |
        package test
        arr := ["first", "second", "third"]
        index := 1
        main := result if {
          result := arr[index]
        }
    query: data.test.main
    want_result: "second"

  - note: mixed_array_object
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := [{"name": "Alice"}, {"name": "Bob"}, [1, 2, 3]]
        }
    query: data.test.main
    want_result: [{"name": "Alice"}, {"name": "Bob"}, [1, 2, 3]]

  - note: set_creation
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := {1, 2, 3, "hello", true}
        }
    query: data.test.main
    want_result:
      set!: [1, 2, 3, "hello", true]

  - note: set_with_duplicates
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := {1, 2, 2, 3, 1}
        }
    query: data.test.main
    want_result:
      set!: [1, 2, 3]

  - note: set_membership
    data: {}
    modules:
      - |
        package test
        my_set := {1, 2, 3, 4, 5}
        main := result if {
          result := 3 in my_set
        }
    query: data.test.main
    want_result: true

  - note: set_non_membership
    data: {}
    modules:
      - |
        package test
        my_set := {"a", "b", "c"}
        main := result if {
          result := "d" in my_set
        }
    query: data.test.main
    want_result: false

  - note: nested_sets
    data: {}
    modules:
      - |
        package test
        main := result if {
          result := {{1, 2}, {3, 4}, {"a", "b"}}
        }
    query: data.test.main
    want_result:
      set!:
        - set!: [1, 2]
        - set!: [3, 4]
        - set!: ["a", "b"]

  # Loop functionality tests (simplified for initial testing)
  - note: basic_variable_test
    data: {}
    modules:
      - |
        package test
        main := result if {
          x := 5
          result := x > 2
        }
    query: data.test.main
    want_result: true

  - note: basic_some_test
    data: {}
    modules:
      - |
        package test
        main := result if {
          some x in [1, 2, 3]
          x > 2
          result := x
        }
    query: data.test.main
    want_result: 3

  - note: basic_every_test
    data: {}
    modules:
      - |
        package test
        main := result if {
          every x in [1, 2, 3] {
            x > 0
          }
          result := true
        }
    query: data.test.main
    want_result: true

  - note: simple_loop_test
    data: {}
    modules:
      - |
        package test
        main := result if {
          x := 1
          y := 2
          result := x * y
        }
    query: data.test.main
    want_result: 2

  - note: loop_array_comprehension
    data: {}
    modules:
      - |
        package test
        main := [(x * 2) | x := [1, 2, 3][_]]
    query: data.test.main
    want_result: [2, 4, 6]

  - note: loop_set_comprehension
    data: {}
    modules:
      - |
        package test
        main := {(x * 2) | x := [1, 2, 3][_]}
    query: data.test.main
    want_result:
      set!: [2, 4, 6]

  - note: loop_object_comprehension
    data: {}
    modules:
      - |
        package test
        main := {k: (v * 2) | v := {"a": 1, "b": 2, "c": 3}[k]}
    query: data.test.main
    want_result:
      a: 2
      b: 4
      c: 6
